# üéâ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–´–ü–û–õ–ù–ï–ù–û

## üìã –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 3 —Ñ–∞–π–ª–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

1. **src/lib/uzum-api.ts**
   - –ò–∑–º–µ–Ω–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ –ø—É—Ç–∏ –∫ API
   - –ë—ã–ª–æ: POST —Å JSON body `{ path, method, headers, body }`
   - –°—Ç–∞–ª–æ: HTTP –∑–∞–ø—Ä–æ—Å —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `X-Uzum-Path`
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: —Ç–æ–∫–µ–Ω –ë–ï–ó –ø—Ä–µ—Ñ–∏–∫—Å–∞ "Bearer" ‚úÖ
   - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: `getShops()`, `getFbsOrdersCount()`, etc.

2. **vite.config.ts**
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–æ–∫—Å–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø—É—Ç–∏ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
   - –ë—ã–ª–æ: –ø—Ä–æ—Å—Ç–æ–π `rewrite` (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª)
   - –°—Ç–∞–ª–æ: `configure` —Å –ø–µ—Ä–µ—Ö–≤–∞—Ç–æ–º `proxyReq` –∏ —á—Ç–µ–Ω–∏–µ–º `X-Uzum-Path`
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ–±—Ä–æ—Å Authorization –∑–∞–≥–æ–ª–æ–≤–∫–∞

3. **functions/api/uzum-proxy.js**
   - –ò–∑–º–µ–Ω–µ–Ω handler —Å `onRequestPost` –Ω–∞ `onRequest`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö HTTP –º–µ—Ç–æ–¥–æ–≤ (GET/POST/PUT/DELETE)
   - –ß—Ç–µ–Ω–∏–µ –ø—É—Ç–∏ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Uzum-Path`
   - –ü—Ä–æ–±—Ä–æ—Å –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### üìÅ –°–æ–∑–¥–∞–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã

1. **QUICK_TEST.md** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
2. **PROXY_FIX_CHECKLIST.md** - –ø–æ–ª–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
3. **PROXY_FIX_DIFF.md** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ç—á–∏
4. **test_proxy_fix.mjs** - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ï–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ DEV + PROD
```javascript
// –¢–µ–ø–µ—Ä—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ:
fetch('/api/uzum-proxy', {
  method: 'GET',
  headers: {
    'X-Uzum-Path': '/v1/shops',
    'Authorization': token
  }
})
```

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```
Authorization: <token>  ‚úÖ (–ë–ï–ó "Bearer")
```

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
```
/v2/fbs/orders/count?shopIds=96273  ‚úÖ (–∏–º–µ–Ω–Ω–æ shopIds, –Ω–µ shopId)
```

---

## üöÄ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –ú–µ—Ç–æ–¥ 1: –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
npm run dev
```
‚Üí –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5173  
‚Üí –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Uzum  
‚Üí –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω  
‚Üí –ù–∞–∂–º–∏—Ç–µ "Test token"  
‚Üí –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)  

**–û–∂–∏–¥–∞–µ–º:**
```
‚úÖ üè™ Raw shops API response: [...]
‚úÖ üìã Raw orders count API response: 42
```

### –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
```bash
node test_proxy_fix.mjs <—Ç–æ–∫–µ–Ω> <shop_id>
```

### –ú–µ—Ç–æ–¥ 3: –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```bash
npm run build
npx wrangler pages deploy dist
```
‚Üí –û—Ç–∫—Ä–æ–π—Ç–µ production URL  
‚Üí –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —à–∞–≥–∏ –∏–∑ –ú–µ—Ç–æ–¥–∞ 1  

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –î–û –∏ –ü–û–°–õ–ï

### ‚ùå –î–û (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ)
```
Frontend
  ‚Üì POST /api/uzum-proxy
  ‚Üì body: { path: "/v1/shops", method: "GET", headers: {...} }
  ‚Üì
Vite Proxy (rewrite)
  ‚Üì rewrite: /api/uzum-proxy ‚Üí /api/seller-openapi
  ‚Üì (–ø—É—Ç—å —Ç–µ—Ä—è–ª—Å—è, –∑–∞–ø—Ä–æ—Å –Ω–∞ –∫–æ—Ä–µ–Ω—å API)
  ‚Üì
Uzum API ‚ùå 404
```

### ‚úÖ –ü–û–°–õ–ï (—Ä–∞–±–æ—Ç–∞–µ—Ç)
```
Frontend
  ‚Üì GET /api/uzum-proxy
  ‚Üì headers: { X-Uzum-Path: "/v1/shops", Authorization: token }
  ‚Üì
DEV: Vite Proxy (configure)
     ‚Üì —á–∏—Ç–∞–µ—Ç X-Uzum-Path
     ‚Üì proxyReq.path = /api/seller-openapi/v1/shops
     ‚Üì
     Uzum API ‚úÖ 200 OK

PROD: Cloudflare Function
      ‚Üì —á–∏—Ç–∞–µ—Ç X-Uzum-Path
      ‚Üì fetch('https://api-seller.uzum.uz/api/seller-openapi/v1/shops')
      ‚Üì
      Uzum API ‚úÖ 200 OK
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –°–±–æ—Ä–∫–∞
```bash
npm run build
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Å–±–æ—Ä–∫–∞ –±–µ–∑ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏–∑–∞—Ü–∏—è
```bash
npx tsc --noEmit
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ –∂–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –°–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ UI –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç

---

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ API

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚úÖ `App.tsx` - getShops()
- ‚úÖ `UzumDashboard.tsx` - getShops(), getFbsOrdersCount()
- ‚úÖ `UzumOrders.tsx` - getShops(), getFbsOrders(), confirmFbsOrder()
- ‚úÖ `UzumProducts.tsx` - getShops(), getProducts()
- ‚úÖ `UzumFinance.tsx` - getShops(), getFinanceOrders()

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ä–µ—à–µ–Ω—ã)

1. ~~CORS –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞~~ ‚Üí ‚úÖ –†–µ—à–µ–Ω–æ –ø—Ä–æ–∫—Å–∏
2. ~~–†–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ DEV/PROD~~ ‚Üí ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ
3. ~~–ü–æ—Ç–µ—Ä—è –ø—É—Ç–∏ –≤ Vite proxy~~ ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ X-Uzum-Path
4. ~~POST-only –≤ CF Function~~ ‚Üí ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –ø–æ–¥–¥–µ—Ä–∂–∞–Ω—ã

---

## üìù –ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–µ–Ω–æ (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)

- ‚ùå –ù–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- ‚ùå –ù–µ –∏–∑–º–µ–Ω–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚ùå –ù–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚ùå –ù–µ –∏–∑–º–µ–Ω–µ–Ω UI
- ‚ùå –ù–µ –∏–∑–º–µ–Ω–µ–Ω—ã –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π
- ‚ùå –ù–µ –∏–∑–º–µ–Ω–µ–Ω—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

–ò–∑–º–µ–Ω–µ–Ω –¢–û–õ–¨–ö–û —Å–µ—Ç–µ–≤–æ–π —Å–ª–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Uzum API.

---

## üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢

### –ü–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω src/lib/uzum-api.ts
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω vite.config.ts
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω functions/api/uzum-proxy.js
- [x] –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–±–æ—Ä–∫–∞

### –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run dev`
- [ ] –û—Ç–∫—Ä—ã—Ç—å http://localhost:5173
- [ ] –ü–µ—Ä–µ–π—Ç–∏ –≤ Uzum —Ä–∞–∑–¥–µ–ª
- [ ] –í—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
- [ ] –ù–∞–∂–∞—Ç—å "Test token"
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –Ω–∞ —É—Å–ø–µ—à–Ω—ã–µ –ª–æ–≥–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CORS –æ—à–∏–±–æ–∫
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–ø—É—Å—Ç–∏—Ç—å `node test_proxy_fix.mjs <—Ç–æ–∫–µ–Ω> <shop_id>`
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ PROD

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏
1. –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ë–ï–ó –ø—Ä–µ—Ñ–∏–∫—Å–∞ "Bearer"
2. –ü–∞—Ä–∞–º–µ—Ç—Ä –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `shopIds` (–Ω–µ `shopId`)
3. –ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤ DEV –∏ PROD
4. –í—Å–µ HTTP –º–µ—Ç–æ–¥—ã –ø–æ–¥–¥–µ—Ä–∂–∞–Ω—ã (GET/POST/PUT/DELETE)

### –§–∞–π–ª—ã –¥–ª—è —á—Ç–µ–Ω–∏—è
- `QUICK_TEST.md` - —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∫–∏
- `PROXY_FIX_CHECKLIST.md` - –¥–µ—Ç–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç
- `PROXY_FIX_DIFF.md` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## ‚ú® –ò—Ç–æ–≥

‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã Uzum API —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –ø—Ä–æ–∫—Å–∏ `/api/uzum-proxy`  
‚úÖ DEV –∏ PROD –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º  
‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–±–µ–∑ "Bearer")  
‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç API (shopIds)  
‚úÖ –°–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ  
‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞  

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! üéâ**
